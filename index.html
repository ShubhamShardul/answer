<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Will You Be My Valentine?</title>
<style>
  :root{ 
    --accent:#ff4d6d; 
    --accent-light:#ff8fa3;
    --accent-dark:#e63b5c;
    --success:#06d6a0;
    --bg-gradient-1:#fff1f5; 
    --bg-gradient-2:#ffe6eb; 
    --bg-gradient-3:#ffb3c1;
    --muted:#6e6e6e;
    --text:#1a1a1a;
    --text-light:#4a4a4a;
    --border:#f0f0f0;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Roboto,"Noto Sans",sans-serif;color:var(--text);}
  body{
    display:grid;
    place-items:center;
    padding:20px;
    background:linear-gradient(135deg,#fff1f5 0%,#ffe6eb 40%,#ffb3c1 80%,#ff99b5 100%);
    overflow:hidden;
    min-height:100vh;
  }
  
  .card{
    width:100%;
    max-width:520px;
    background:#fff;
    border-radius:32px;
    padding:60px 48px;
    box-shadow:0 24px 80px rgba(255,77,109,0.25);
    text-align:center;
    position:relative;
    backdrop-filter:blur(10px);
  }
  
  h1{
    color:var(--accent);
    margin:0 0 20px;
    font-size:36px;
    font-weight:900;
    letter-spacing:-1px;
    background:linear-gradient(135deg,var(--accent),var(--accent-light));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    line-height:1.2;
  }
  
  .sub{
    font-size:17px;
    color:var(--text-light);
    margin:0 0 48px;
    font-weight:500;
    line-height:1.7;
  }
  
  .row{
    display:flex;
    gap:18px;
    justify-content:center;
    align-items:center;
    margin-bottom:0;
    flex-wrap:wrap;
  }
  
  button{
    padding:14px 24px;
    border-radius:16px;
    border:none;
    cursor:pointer;
    font-weight:700;
    font-size:16px;
    transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    position:relative;
    overflow:hidden;
  }
  
  button:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(0,0,0,0.12);
  }
  
  button:active{
    transform:translateY(0);
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
  }
  
  .yes{
    background:linear-gradient(135deg,var(--accent),var(--accent-light));
    color:#fff;
    padding:16px 40px;
    font-size:17px;
    min-width:160px;
    flex:1;
    box-shadow:0 8px 24px rgba(255,77,109,0.3);
  }
  
  .yes:hover{
    box-shadow:0 12px 32px rgba(255,77,109,0.4);
  }
  
  .no{
    background:#f8f8f8;
    color:var(--text);
    border:2px solid var(--border);
    transition:all 0.3s ease;
    flex:1;
    font-size:17px;
    padding:14px 40px;
  }
  
  .no:hover{
    background:#fff;
    border-color:var(--accent);
    color:var(--accent);
  }
  
  
  @keyframes floatUp { 
    0%{transform:translateY(100vh) scale(1) rotateZ(0deg);opacity:1}
    50%{opacity:1}
    100%{transform:translateY(-20vh) scale(0.5) rotateZ(360deg);opacity:0}
  }
  
  @keyframes bounce {
    0%, 100% { transform:scale(1) }
    50% { transform:scale(1.1) }
  }
  
  .overlay{
    position:fixed;
    inset:0;
    display:none;
    place-items:center;
    background:rgba(0,0,0,0.45);
    backdrop-filter:blur(4px);
    z-index:999;
    animation:fadeIn 0.2s ease;
  }
  
  @keyframes fadeIn {
    from{opacity:0;backdrop-filter:blur(0)}
    to{opacity:1;backdrop-filter:blur(4px)}
  }
  
  .modal{
    background:#fff;
    padding:32px;
    border-radius:20px;
    max-width:520px;
    width:92%;
    box-shadow:0 20px 60px rgba(0,0,0,0.2);
    animation:slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
  }
  
  @keyframes slideUp {
    from{transform:translateY(40px);opacity:0}
    to{transform:translateY(0);opacity:1}
  }
  
  .tiny-muted{
    font-size:12px;
    color:var(--muted);
    margin-top:16px;
    font-weight:500;
  }
  
  .clone{
    position:fixed;
    z-index:900;
    cursor:pointer;
    padding:10px 16px;
    border-radius:14px;
    border:2px solid var(--accent);
    background:linear-gradient(135deg,#fff,#fafafa);
    font-weight:800;
    font-size:14px;
    box-shadow:0 8px 20px rgba(255,77,109,0.25);
    transition:all 0.2s ease;
    color:var(--accent);
    animation:pulse 2s infinite;
  }
  
  .clone:hover{
    transform:scale(1.05);
    box-shadow:0 12px 28px rgba(255,77,109,0.35);
  }
  
  @keyframes pulse {
    0%, 100%{opacity:1}
    50%{opacity:0.7}
  }
  
  svg{
    transition:transform 0.15s cubic-bezier(0.34,1.56,0.64,1);
    filter:drop-shadow(0 4px 12px rgba(255,77,109,0.15));
  }
  
  .keymap{
    display:flex;
    gap:12px;
    justify-content:center;
    margin-top:20px;
    flex-wrap:wrap;
  }
  
  .key{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    color:var(--muted);
    font-weight:600;
    background:rgba(0,0,0,0.03);
    padding:6px 10px;
    border-radius:8px;
    border:1px solid rgba(0,0,0,0.08);
  }
  
  @media (max-width:480px){ 
    .card{
      padding:40px 24px;
      border-radius:24px;
    }
    h1{font-size:28px;margin-bottom:12px;}
    .sub{margin-bottom:32px;font-size:15px;}
    .row{gap:12px}
    button{padding:12px 16px;font-size:15px}
  }
</style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <main class="card" role="application" aria-labelledby="q">
    <h1 id="q">Will you be my Valentine? ‚ù§Ô∏è</h1>
    <p class="sub">Click Yes if you mean it. Click No to witness what happens.</p>

    <div class="row">
      <button id="yesBtn" class="yes" aria-label="Yes">Yes üíò</button>
      <button id="noBtn" class="no" aria-label="No">No üôà</button>
    </div>
  </main>

<script>
/* === CLEAN VALENTINE APP ===
   Simplified, playful, and robust.
   Goals:
   - Clean, focused UX with just Yes/No buttons
   - Yes click triggers victory with celebration
   - No button evades clicks with playful behavior
   - Yes clones spawn when clicking No (based on interaction count)
   - Full cleanup on page reload or reset
*/

/* ---------- Utilities ---------- */
const $ = sel => document.querySelector(sel);
const rand = (a,b) => a + Math.random() * (b - a);
const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
function now() { return Date.now(); }

/* ---------- Elements ---------- */
const yesBtn = $('#yesBtn'), noBtn = $('#noBtn');
const confettiCanvas = document.getElementById('confetti');
const qEl = $('#q'), subtitle = document.querySelector('.sub');

/* ---------- State ---------- */
const STATE = {
  accepted: false,
  attempts: 0
};

const CONFIG = {
  MAX_CLONES: 3,
  CLONE_TTL_MS: 9000
};

/* track timers so we can clear them */
const TIMERS = new Set();

/* ---------- Audio (gesture-friendly) ---------- */
let audioCtx = null;
function ensureAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
}
function playTone(freq=660, dur=0.12, type='sine', vol=0.12) {
  try {
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    const stopId = setTimeout(() => { try { o.stop(); } catch(e){} }, (dur + 0.05) * 1000);
    TIMERS.add(stopId);
  } catch(e){}
}
function boing(){ playTone(660,0.14,'sine',0.12); playTone(880,0.08,'sine',0.06); }
function pop(){ playTone(760,0.06,'square',0.14); }
function tada(){ playTone(880,0.14,'sine',0.12); playTone(660,0.18,'sine',0.12); }

/* ---------- Confetti (single, robust) ---------- */
const ctx = confettiCanvas.getContext ? confettiCanvas.getContext('2d') : null;
let confettiPieces = [], confettiRaf = null;
function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function spawnConfetti(count=60){
  if (!ctx) return;
  for (let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random() * confettiCanvas.width,
      y: -10 - Math.random()*200,
      w: 6 + Math.random()*10,
      h: 8 + Math.random()*10,
      vx: rand(-3,3),
      vy: rand(2,6),
      rot: Math.random()*360,
      vr: rand(-6,6),
      color: ['#ff4d6d','#ffd166','#06d6a0','#118ab2','#bd7efc'][i % 5],
      life: 0
    });
  }
  if (!confettiRaf) confettiRaf = requestAnimationFrame(tickConfetti);
}
function tickConfetti(){
  if (!ctx) return;
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  for (const p of confettiPieces){
    p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.rot += p.vr; p.life ++;
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot * Math.PI/180);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
  }
  confettiPieces = confettiPieces.filter(p => p.y < confettiCanvas.height + 100);
  if (confettiPieces.length) confettiRaf = requestAnimationFrame(tickConfetti);
  else { cancelAnimationFrame(confettiRaf || 0); confettiRaf = null; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
}

/* ---------- Hearts ---------- */
function launchHearts(rate=30){
  const burst = Math.max(6, Math.floor(rate/3) + Math.floor(Math.random()*rate/4));
  for (let i=0;i<burst;i++){
    const el = document.createElement('div');
    el.className = 'heart';
    el.style.left = (Math.random()*92) + 'vw';
    el.style.fontSize = (14 + Math.random()*32) + 'px';
    el.textContent = Math.random() > 0.6 ? 'üíñ' : '‚ù§Ô∏è';
    el.style.setProperty('--delay', (i * 0.05) + 's');
    document.body.appendChild(el);
    const t = setTimeout(()=> {
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 300);
    }, 4200 + Math.random()*1500);
    TIMERS.add(t);
  }
}

/* ---------- spawnYesClone (chasing clone) ---------- */
let clonesCount = 0;
const cloneListeners = new Map();
function spawnYesClone() {
  if (STATE.accepted) return;
  if (clonesCount >= CONFIG.MAX_CLONES) return;
  clonesCount++;

  const c = document.createElement('button');
  c.className = 'clone';
  c.textContent = 'Yes! üòç';
  const left = Math.random()*(window.innerWidth - 120);
  const top = Math.random()*(window.innerHeight - 70);
  c.style.left = left + 'px';
  c.style.top = top + 'px';
  c.style.padding = '8px 12px';
  document.body.appendChild(c);

  function chase(e){
    const r = c.getBoundingClientRect();
    const dx = e.clientX - (r.left + r.width/2);
    const dy = e.clientY - (r.top + r.height/2);
    c.style.left = (r.left + dx*0.12) + 'px';
    c.style.top = (r.top + dy*0.12) + 'px';
  }
  window.addEventListener('mousemove', chase);
  cloneListeners.set(c, chase);

  c.addEventListener('click', () => {
    c.remove();
    const listener = cloneListeners.get(c);
    if (listener) window.removeEventListener('mousemove', listener);
    cloneListeners.delete(c);
    clonesCount = Math.max(0, clonesCount-1);
    accept();
  });

  const ttl = setTimeout(()=> {
    try { 
      c.remove();
      const listener = cloneListeners.get(c);
      if (listener) window.removeEventListener('mousemove', listener);
      cloneListeners.delete(c);
    } catch(e){}
    clonesCount = Math.max(0, clonesCount-1);
  }, CONFIG.CLONE_TTL_MS);
  TIMERS.add(ttl);
}

/* ---------- Move No button safely ---------- */
function moveNoButtonRandomly() {
  const pad = 12;
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const btnW = Math.min(140, Math.max(80, noBtn.offsetWidth || 110));
  const btnH = Math.min(60, Math.max(36, noBtn.offsetHeight || 44));
  let left = Math.random() * (vw - btnW - pad*2) + pad;
  let top = Math.random() * (vh - btnH - pad*2) + pad;
  left = clamp(left, pad, vw - btnW - pad);
  top  = clamp(top, pad, vh - btnH - pad);
  noBtn.style.position = 'fixed';
  noBtn.style.left = left + 'px';
  noBtn.style.top = top + 'px';
  noBtn.style.transform = '';
}

/* ---------- accept() idempotent ---------- */
function accept() {
  if (STATE.accepted) return;
  STATE.accepted = true;
  
  subtitle.textContent = 'YAY!! You said YES üíñ';
  subtitle.style.animation = 'none';
  setTimeout(() => {
    subtitle.style.animation = 'bounce 0.6s cubic-bezier(0.34,1.56,0.64,1)';
  }, 10);
  
  try { ensureAudio(); } catch(e){}
  tada();
  spawnConfetti(160);
  launchHearts(140);
  
  qEl.style.animation = 'none';
  setTimeout(() => {
    qEl.style.animation = 'bounce 0.8s cubic-bezier(0.34,1.56,0.64,1)';
  }, 10);
  
  setTimeout(()=> {
    try { 
      noBtn.style.opacity = '0';
      noBtn.style.transform = 'scale(0.9)';
      setTimeout(() => {
        noBtn.style.display = 'none';
      }, 300);
    } catch(e){}
  }, 400);
  
  document.querySelectorAll('.clone').forEach(n=> {
    const listener = cloneListeners.get(n);
    if (listener) window.removeEventListener('mousemove', listener);
    cloneListeners.delete(n);
    n.style.opacity = '0';
    setTimeout(() => n.remove(), 200);
  });
  clonesCount = 0;
}

/* ---------- No button behavior ---------- */
function onNoInteracted() {
  if (STATE.accepted) return;
  STATE.attempts++;
  moveNoButtonRandomly();
  
  const level = Math.min(10, STATE.attempts);
  if (level >= 1) boing();
  
  if (Math.random() < 0.22 && level >= 2) {
    const old = noBtn.textContent;
    noBtn.textContent = Math.random() > 0.5 ? 'Yes üòÄ' : 'Maybe?';
    setTimeout(()=> { try { noBtn.textContent = old; } catch(e){} }, 700 + Math.random()*900);
  }
  
  if (Math.random() < (0.12 + level*0.04)) {
    spawnYesClone();
  }
}

/* ---------- Reset / cleanup ---------- */
function clearAllTimers() {
  for (const t of Array.from(TIMERS)) {
    try { clearTimeout(t); } catch(e){}
    TIMERS.delete(t);
  }
}
function resetAll() {
  clearAllTimers();
  
  try { if (confettiRaf) cancelAnimationFrame(confettiRaf); } catch(e){}
  confettiRaf = null; confettiPieces = []; ctx && ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  
  document.querySelectorAll('.clone').forEach(n => {
    const listener = cloneListeners.get(n);
    if (listener) window.removeEventListener('mousemove', listener);
    cloneListeners.delete(n);
    n.remove();
  });
  
  document.querySelectorAll('.heart').forEach(n => n.remove());
  
  noBtn.style.display = '';
  noBtn.style.position = 'relative';
  noBtn.style.left = ''; 
  noBtn.style.top = ''; 
  noBtn.style.transform = '';
  noBtn.style.opacity = '1';
  
  STATE.accepted = false;
  STATE.attempts = 0;
  clonesCount = 0;
  qEl.textContent = 'Will you be my Valentine? ‚ù§Ô∏è';
  qEl.style.animation = 'none';
  subtitle.textContent = 'Click Yes if you mean it. Click No to witness what happens.';
  subtitle.style.animation = 'none';
  
  try { if (audioCtx && audioCtx.state !== 'suspended') audioCtx.suspend().catch(()=>{}); } catch(e){}
}

/* ---------- Event wiring ---------- */
noBtn.addEventListener('mouseover', onNoInteracted);
noBtn.addEventListener('click', onNoInteracted);

yesBtn.addEventListener('click', () => {
  accept();
});

document.addEventListener('keydown', (ev) => {
  const k = ev.key.toLowerCase();
  if (k === 'y') yesBtn.click();
  if (k === 'n') noBtn.click();
});

/* Reset on page reload */
window.addEventListener('beforeunload', () => {
  resetAll();
});

/* Initial celebratory hearts */
setTimeout(() => {
  launchHearts(18);
}, 600);

/* Testing helpers */
window.__VALENTINE = {
  STATE,
  spawnYesClone,
  spawnConfetti,
  launchHearts,
  resetAll,
  accept
};

/* End of script */
</script>
</body>
</html>
